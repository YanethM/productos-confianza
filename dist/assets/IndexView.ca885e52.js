import{b as C,F as T,E as I,d as B,o as F,c as L,p as N,f as $,a as k,g as E,i as U,h as u}from"./moment.90abcc35.js";import{c as D,a as x,b as o}from"./object.ec3bc54f.js";import{_ as K,B as O,r as g,o as n,c as d,a as s,w as v,F as f,b as r,t as _,e as h,I as q,J as S,K as Y,p as G,g as P,L as Z,d as H}from"./index.3e1e514d.js";import{T as J}from"./TimerView.d0e8420d.js";const R={components:{BaseLoading:O,Field:C,Form:T,ErrorMessage:I,TimerView:J},data(){return{data:{departamento:"",provincia:"",distrito:"",agency:"",amount:"",name:"",last_name:"",birthDate:"",expirationDate:""},offices:[],loading:!1,departamentos:B,provincias_select:[],distritos_select:[]}},beforeCreate(){this.$store.state.token.token||this.$router.push({name:"Home",params:{product:this.$route.params.product}})},methods:{onlyLetters:F,onlyNumbers:L,getDepartamento(){this.data.provincia="",this.data.distrito="",this.data.agency="",this.provincias_select=[],this.distritos_select=[],this.provincias_select=N.filter(i=>i.departamento_id===this.data.departamento)},getProvincia(){this.data.distrito="",this.data.agency="",this.distritos_select=[],this.distritos_select=$.filter(i=>i.provincia_id===this.data.provincia)},findOffices(){this.data.agency="",this.loading=!0,this.offices=[];let i={params:{country:"604",department:`${this.data.departamento}`,province:`${this.data.provincia}`,district:`${this.data.distrito}`},headers:{"x-address":this.$store.state.token.xAddress,"x-api-key":this.$store.state.token.xApiKey,token:this.$store.state.token.token,"token-bt":this.$store.state.token.tokenBT}};k.get("/landing-agency",i).then(e=>{e.data.code==="0"?this.offices=e.data.agencies:(this.$store.dispatch("message/SET_MESSAGE",e.data.message),this.$router.push({name:"Message",params:{product:this.$route.params.product}}))}).catch(()=>{this.$store.dispatch("message/SET_MESSAGE","Se ha generado un error al procesar la solicitud. Intente nuevamente en unos minutos."),this.$router.push({name:"Message",params:{product:this.$route.params.product}})}).finally(()=>{this.loading=!1})},saveData(){this.loading=!0;let i={token:`${this.$store.state.token.token}`,tokenBT:`${this.$store.state.token.tokenBT}`,names:E(this.data.name),lastNames:E(this.data.last_name),ubigeoDepartment:`${this.data.departamento}`,ubigeoProvince:`${this.data.provincia}`,ubigeoDistrict:`${this.data.distrito}`,agency:`${this.data.agency}`,amountRequested:`${this.data.amount}`,birthDate:E(this.data.birthDate),expirationDate:E(this.data.expirationDate),mode:"2"},e={"x-address":this.$store.state.token.xAddress,"x-api-key":this.$store.state.token.xApiKey,"X-MAC":U(i)};k.put("/landing-credit-apply",i,{headers:e}).then(p=>{p.data.code==="0"?(this.$store.dispatch("message/SET_MESSAGE",p.data.message),this.$router.push({name:"Message",params:{product:this.$route.params.product}})):(this.$store.dispatch("message/SET_MESSAGE",p.data.message),this.$router.push({name:"Message",params:{product:this.$route.params.product}}))}).catch(()=>{this.$store.dispatch("message/SET_MESSAGE","Se ha generado un error al procesar la solicitud. Intente nuevamente en unos minutos."),this.$router.push({name:"Message",params:{product:this.$route.params.product}})}).finally(()=>{this.loading=!1})}},computed:{clientName(){return this.$store.state.token.existeBT==="S"?this.$store.state.user.name:this.$store.state.user.document_num},isClient(){return this.$store.state.token.existeBT==="S"},isCE(){return this.$store.state.user.document_type===2},isOlder(){return u().subtract(19,"years").format("YYYY-MM-DD")},schema(){if(this.isClient)return this.$store.state.credit.adviserExists==="S"?D({amount:x().required("El campo es requerido").min(300,"El monto debe ser mayor o igual a S/ 300").max(7e4,"El monto debe ser menor o igual a S/ 70,000").typeError("Ingrese el monto")}):D({amount:x().required("El campo es requerido").min(300,"El monto debe ser mayor o igual a S/ 300").max(7e4,"El monto debe ser menor o igual a S/ 70,000").typeError("Ingrese el monto"),departamento:o().required("El campo es requerido"),provincia:o().required("El campo es requerido"),distrito:o().required("El campo es requerido"),agency:o().required("Seleccione la agencia m\xE1s cercana.")});if(this.isCE){const i=new Date;return D({name:o().required("El campo es requerido").matches(/[a-zA-Z ]{2,254}/,"El campo solo puede contener letras",{excludeEmptyString:!0}),last_name:o().required("El campo es requerido").matches(/[a-zA-Z ]{2,254}/,"El campo solo puede contener letras",{excludeEmptyString:!0}),birthDate:o().transform(e=>u(e,"DD/MM/YYYY",!0).format("YYYY-MM-DD")).required("El campo es requerido").test("is-valid-date","La fecha ingresada no es v\xE1lida",e=>u(e,"YYYY-MM-DD",!0).isValid()).test("is-older-than-19","Debes ser mayor a 19 a\xF1os",e=>{if(u(e,"YYYY-MM-DD",!0).isValid()){const p=u(),M=u(e,"YYYY-MM-DD");return p.diff(M,"years")>=19}return!0}),expirationDate:o().transform(e=>u(e,"DD/MM/YYYY",!0).format("YYYY-MM-DD")).required("El campo es requerido").test("is-valid-date","La fecha ingresada no es v\xE1lida",e=>u(e,"YYYY-MM-DD",!0).isValid()).test("is-valid-expiration-date","La fecha de vencimiento no puede ser anterior a la actual",e=>u(e,"YYYY-MM-DD",!0).isValid()?u(e,"YYYY-MM-DD").isSameOrAfter(i,"day"):!0),amount:x().required("El campo es requerido").min(300,"El monto debe ser mayor o igual a S/ 300").max(7e4,"El monto debe ser menor o igual a S/ 70,000").typeError("Ingrese el monto"),departamento:o().required("El campo es requerido"),provincia:o().required("El campo es requerido"),distrito:o().required("El campo es requerido"),agency:o().required("Seleccione la agencia m\xE1s cercana.")})}else return D({name:o().required("El campo es requerido").matches(/[a-zA-Z ]{2,254}/,"El campo solo puede contener letras",{excludeEmptyString:!0}),last_name:o().required("El campo es requerido").matches(/[a-zA-Z ]{2,254}/,"El campo solo puede contener letras",{excludeEmptyString:!0}),amount:x().required("El campo es requerido").min(300,"El monto debe ser mayor o igual a S/ 300").max(7e4,"El monto debe ser menor o igual a S/ 70,000").typeError("Ingrese el monto"),departamento:o().required("El campo es requerido"),provincia:o().required("El campo es requerido"),distrito:o().required("El campo es requerido"),agency:o().required("Seleccione la agencia m\xE1s cercana.")})}}},y=i=>(G("data-v-60a23f56"),i=i(),P(),i),X={class:"container"},j={class:"product_wizard_step_2__title"},Q=y(()=>r("h5",null,"Antes de continuar, por favor ingresa el monto que necesitas",-1)),W={class:"product_wizard_step_2__inputs"},ee={key:0,class:"product_wizard_step_2__inputs-item"},te={key:1,class:"product_wizard_step_2__inputs-item"},ae={key:2,class:"product_wizard_step_2__inputs-item"},se={key:3,class:"product_wizard_step_2__inputs-item"},re={class:"product_wizard_step_2__inputs-item"},oe={key:0,class:"product_active__selection-office"},ie=y(()=>r("p",{class:"product_active__selection-office-title"}," Selecciona el lugar donde vives para que selecciones la oficina mas cerca a t\xED: ",-1)),ne={class:"product_wizard_step_2__selects"},de={class:"product_wizard_step_2__selects-item"},le=y(()=>r("label",null,"Departamento",-1)),ue=["value"],me={class:"product_wizard_step_2__selects-item"},ce=y(()=>r("label",null,"Provincia",-1)),pe=["value"],_e={class:"product_wizard_step_2__selects-item"},he=y(()=>r("label",null,"Distrito",-1)),ge=["value"],ve={class:"product_wizard_step_2__result"},fe={key:0,class:"product_wizard_step_2__result"},ye=["value"],Ee={class:"product_wizard_step_2__result"},De={type:"submit",class:"button"};function xe(i,e,p,M,a,l){const w=g("TimerView"),m=g("Field"),c=g("ErrorMessage"),V=g("BaseLoading"),z=g("Form");return n(),d(f,null,[s(w),s(z,{onSubmit:l.saveData,"validation-schema":l.schema,class:"product_wizard product_wizard_step_2"},{default:v(()=>[r("div",X,[r("div",j,[r("h4",null,"\xA1Hola "+_(l.clientName)+"!",1),Q]),r("div",W,[l.isClient?h("",!0):(n(),d("div",ee,[s(m,{name:"name",class:"input-text",placeholder:"Nombres",modelValue:a.data.name,"onUpdate:modelValue":e[0]||(e[0]=t=>a.data.name=t),onKeypress:e[1]||(e[1]=t=>l.onlyLetters(t))},null,8,["modelValue"]),s(c,{name:"name",class:"message-error"})])),l.isClient?h("",!0):(n(),d("div",te,[s(m,{name:"last_name",class:"input-text",placeholder:"Apellidos",modelValue:a.data.last_name,"onUpdate:modelValue":e[2]||(e[2]=t=>a.data.last_name=t),onKeypress:e[3]||(e[3]=t=>l.onlyLetters(t))},null,8,["modelValue"]),s(c,{name:"last_name",class:"message-error"})])),l.isCE?(n(),d("div",ae,[s(m,{type:"text",max:l.isOlder,name:"birthDate",class:"input-text",placeholder:"Fecha de nacimiento (dd/mm/aaaa)",modelValue:a.data.birthDate,"onUpdate:modelValue":e[4]||(e[4]=t=>a.data.birthDate=t)},null,8,["max","modelValue"]),s(c,{name:"birthDate",class:"message-error"})])):h("",!0),l.isCE?(n(),d("div",se,[s(m,{type:"text",name:"expirationDate",class:"input-text",placeholder:"Fecha de Expiraci\xF3n de DOI (dd/mm/aaaa)",modelValue:a.data.expirationDate,"onUpdate:modelValue":e[5]||(e[5]=t=>a.data.expirationDate=t)},null,8,["modelValue"]),s(c,{name:"expirationDate",class:"message-error"})])):h("",!0),r("div",re,[s(m,{type:"tel",name:"amount",class:"input-text",placeholder:"Monto a solicitar",autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:"false",equal:"false",modelValue:a.data.amount,"onUpdate:modelValue":e[6]||(e[6]=t=>a.data.amount=t),onKeypress:e[7]||(e[7]=t=>l.onlyNumbers(t))},null,8,["modelValue"]),s(c,{name:"amount",class:"message-error"})])]),i.$store.state.credit.adviserExists==="N"?(n(),d("div",oe,[ie,r("div",ne,[r("div",de,[le,s(m,{as:"select",name:"departamento",class:"input-select",modelValue:a.data.departamento,"onUpdate:modelValue":e[8]||(e[8]=t=>a.data.departamento=t),onChange:e[9]||(e[9]=t=>l.getDepartamento())},{default:v(()=>[(n(!0),d(f,null,q(a.departamentos,t=>(n(),d("option",{value:t.id,key:t},_(t.name),9,ue))),128))]),_:1},8,["modelValue"]),s(c,{name:"departamento",class:"message-error"})]),r("div",me,[ce,s(m,{as:"select",name:"provincia",class:"input-select",modelValue:a.data.provincia,"onUpdate:modelValue":e[10]||(e[10]=t=>a.data.provincia=t),onChange:e[11]||(e[11]=t=>l.getProvincia())},{default:v(()=>[(n(!0),d(f,null,q(a.provincias_select,t=>(n(),d("option",{value:t.id,key:t},_(t.name),9,pe))),128))]),_:1},8,["modelValue"]),s(c,{name:"provincia",class:"message-error"})]),r("div",_e,[he,s(m,{as:"select",name:"distrito",class:"input-select",modelValue:a.data.distrito,"onUpdate:modelValue":e[12]||(e[12]=t=>a.data.distrito=t),onChange:e[13]||(e[13]=t=>l.findOffices())},{default:v(()=>[(n(!0),d(f,null,q(a.distritos_select,t=>(n(),d("option",{value:t.id,key:t},_(t.name),9,ge))),128))]),_:1},8,["modelValue"]),s(c,{name:"distrito",class:"message-error"})])]),S(r("div",ve,[s(V)],512),[[Y,a.loading]]),a.offices.length>0?(n(),d("div",fe,[r("ul",null,[(n(!0),d(f,null,q(a.offices,(t,A)=>(n(),d("li",{key:A},[s(m,{name:"agency",type:"radio",value:!1,modelValue:a.data.agency,"onUpdate:modelValue":e[14]||(e[14]=b=>a.data.agency=b)},{default:v(({field:b})=>[r("label",null,[r("input",Z({type:"radio",name:"terms"},b,{value:t.code}),null,16,ye),H(" "+_(t.name)+" ",1),r("span",null,_(t.address),1)])]),_:2},1032,["modelValue"])]))),128))]),s(c,{name:"agency",class:"message-error"}),S(s(V,null,null,512),[[Y,a.loading]])])):h("",!0)])):h("",!0),r("div",Ee,[S(s(V,null,null,512),[[Y,a.loading]]),S(r("button",De," Solicitar ",512),[[Y,!a.loading]])])])]),_:1},8,["onSubmit","validation-schema"])],64)}var be=K(R,[["render",xe],["__scopeId","data-v-60a23f56"]]);export{be as default};
